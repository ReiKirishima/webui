{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/ix-table/components/ix-table-body/cells/ix-cell-relative-date/ix-cell-relative-date.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/ix-table/components/ix-table-body/cells/ix-cell-relative-date/ix-cell-relative-date.component.ts"],"sourcesContent":["import { ChangeDetectionStrategy, Component, inject } from '@angular/core';\nimport { MatTooltip } from '@angular/material/tooltip';\nimport { TranslateService } from '@ngx-translate/core';\nimport { isValid } from 'date-fns';\nimport { utcToZonedTime, zonedTimeToUtc } from 'date-fns-tz';\nimport { invalidDate } from 'app/constants/invalid-date';\nimport { formatDistanceToNowShortened } from 'app/helpers/format-distance-to-now-shortened';\nimport { ColumnComponent, Column } from 'app/modules/ix-table/interfaces/column-component.class';\nimport { FormatDateTimePipe } from 'app/modules/pipes/format-date-time/format-datetime.pipe';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { LocaleService } from 'app/services/locale.service';\n\n@Component({\n  selector: 'ix-cell-relative-date',\n  templateUrl: './ix-cell-relative-date.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [MatTooltip, TestDirective],\n  providers: [FormatDateTimePipe],\n})\nexport class IxCellRelativeDateComponent<T> extends ColumnComponent<T> {\n  translate: TranslateService;\n  localeService: LocaleService;\n  formatDateTime: FormatDateTimePipe;\n  defaultTz: string = Intl.DateTimeFormat().resolvedOptions().timeZone;\n  machineTimezone: string;\n\n  constructor() {\n    super();\n    this.translate = inject(TranslateService);\n    this.formatDateTime = inject(FormatDateTimePipe);\n    this.localeService = inject(LocaleService);\n    this.machineTimezone = this.localeService.timezone;\n  }\n\n  get machineTime(): Date {\n    const utc = zonedTimeToUtc(this.value as number, this.defaultTz);\n    return utcToZonedTime(utc, this.machineTimezone);\n  }\n\n  get isTimezoneDifference(): boolean {\n    return this.machineTime < this.value || this.machineTime > this.value;\n  }\n\n  get isInvalidDate(): boolean {\n    return this.translate.instant(this.date) === this.translate.instant(invalidDate);\n  }\n\n  get date(): string {\n    if (!this.value) {\n      return this.translate.instant('N/A');\n    }\n\n    if (isValid(this.value)) {\n      return formatDistanceToNowShortened(this.value as number);\n    }\n\n    return this.value as string;\n  }\n\n  get dateTooltip(): string {\n    if (!this.value) {\n      return this.translate.instant('N/A');\n    }\n\n    if (isValid(this.value)) {\n      if (!this.isTimezoneDifference) {\n        return this.formatDateTime.transform(this.machineTime);\n      }\n\n      const browserTime = this.formatDateTime.transform(this.value as number);\n      const machineTime = this.formatDateTime.transform(this.machineTime);\n\n      return this.translate.instant('Machine Time: {machineTime} \\n Browser Time: {browserTime}', {\n        machineTime,\n        browserTime,\n      });\n    }\n\n    return this.value as string;\n  }\n}\n\nexport function relativeDateColumn<T>(\n  options: Partial<IxCellRelativeDateComponent<T>>,\n): Column<T, IxCellRelativeDateComponent<T>> {\n  return { type: IxCellRelativeDateComponent, ...options };\n}\n"],"version":3}