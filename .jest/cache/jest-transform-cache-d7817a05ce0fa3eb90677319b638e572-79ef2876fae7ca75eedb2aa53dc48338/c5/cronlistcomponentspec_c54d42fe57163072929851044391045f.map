{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/advanced/cron/cron-list/cron-list.component.spec.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/advanced/cron/cron-list/cron-list.component.spec.ts"],"sourcesContent":["import { HarnessLoader } from '@angular/cdk/testing';\nimport { TestbedHarnessEnvironment } from '@angular/cdk/testing/testbed';\nimport { MatButtonHarness } from '@angular/material/button/testing';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Spectator } from '@ngneat/spectator';\nimport { createComponentFactory, mockProvider } from '@ngneat/spectator/jest';\nimport { provideMockStore } from '@ngrx/store/testing';\nimport { MockComponent } from 'ng-mocks';\nimport { of } from 'rxjs';\nimport { mockAuth } from 'app/core/testing/utils/mock-auth.utils';\nimport { mockWebSocket, mockCall } from 'app/core/testing/utils/mock-websocket.utils';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { ChainedRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/chained-component-ref';\nimport { SearchInput1Component } from 'app/modules/forms/search-input1/search-input1.component';\nimport { IxTableHarness } from 'app/modules/ix-table/components/ix-table/ix-table.harness';\nimport {\n  IxTableColumnsSelectorComponent,\n} from 'app/modules/ix-table/components/ix-table-columns-selector/ix-table-columns-selector.component';\nimport {\n  IxTableDetailsRowComponent,\n} from 'app/modules/ix-table/components/ix-table-details-row/ix-table-details-row.component';\nimport { IxTableDetailsRowDirective } from 'app/modules/ix-table/directives/ix-table-details-row.directive';\nimport { PageHeaderComponent } from 'app/modules/page-header/page-title-header/page-header.component';\nimport { CronDeleteDialogComponent } from 'app/pages/system/advanced/cron/cron-delete-dialog/cron-delete-dialog.component';\nimport { CronFormComponent } from 'app/pages/system/advanced/cron/cron-form/cron-form.component';\nimport { CronListComponent } from 'app/pages/system/advanced/cron/cron-list/cron-list.component';\nimport { IxChainedSlideInService } from 'app/services/ix-chained-slide-in.service';\nimport { LocaleService } from 'app/services/locale.service';\nimport { TaskService } from 'app/services/task.service';\nimport { WebSocketService } from 'app/services/ws.service';\nimport { selectSystemConfigState } from 'app/store/system-config/system-config.selectors';\n\ndescribe('CronListComponent', () => {\n  let spectator: Spectator<CronListComponent>;\n  let loader: HarnessLoader;\n  let table: IxTableHarness;\n\n  const cronJobs = [\n    {\n      id: 1,\n      user: 'root',\n      command: \"echo 'Hello World'\",\n      description: 'test',\n      enabled: true,\n      stdout: true,\n      stderr: false,\n      schedule: {\n        minute: '0',\n        hour: '0',\n        dom: '*',\n        month: '*',\n        dow: '*',\n      },\n    },\n  ];\n\n  const createComponent = createComponentFactory({\n    component: CronListComponent,\n    imports: [\n      MockComponent(PageHeaderComponent),\n      SearchInput1Component,\n      IxTableColumnsSelectorComponent,\n      IxTableDetailsRowDirective,\n      IxTableDetailsRowComponent,\n    ],\n    providers: [\n      provideMockStore({\n        selectors: [\n          {\n            selector: selectSystemConfigState,\n            value: {},\n          },\n        ],\n      }),\n      mockWebSocket([\n        mockCall('cronjob.query', cronJobs),\n        mockCall('cronjob.run'),\n      ]),\n      mockProvider(DialogService, {\n        confirm: jest.fn(() => of(true)),\n      }),\n      mockProvider(IxChainedSlideInService, {\n        open: jest.fn(() => of({ response: true, error: null })),\n      }),\n      mockProvider(ChainedRef, { close: jest.fn(), getData: jest.fn(() => undefined) }),\n      mockProvider(MatDialog, {\n        open: jest.fn(() => ({\n          afterClosed: () => of(true),\n        })),\n      }),\n      mockProvider(LocaleService),\n      mockProvider(TaskService, {\n        getTaskNextTime: jest.fn(() => new Date(new Date().getTime() + (25 * 60 * 60 * 1000))),\n      }),\n      mockAuth(),\n    ],\n  });\n\n  beforeEach(async () => {\n    spectator = createComponent();\n    loader = TestbedHarnessEnvironment.loader(spectator.fixture);\n    table = await loader.getHarness(IxTableHarness);\n  });\n\n  it('should show table rows', async () => {\n    const expectedRows = [\n      ['Users', 'Command', 'Description', 'Schedule', 'Enabled'],\n      ['root', \"echo 'Hello World'\", 'test', '0 0 * * *', 'Yes'],\n    ];\n\n    const cells = await table.getCellTexts();\n    expect(cells).toEqual(expectedRows);\n  });\n\n  it('shows form to add new cronjob when Add button is pressed', async () => {\n    const addButton = await loader.getHarness(MatButtonHarness.with({ text: 'Add' }));\n    await addButton.click();\n\n    expect(spectator.inject(IxChainedSlideInService).open).toHaveBeenCalledWith(CronFormComponent);\n  });\n\n  it('shows confirmation dialog when Run Now button is pressed', async () => {\n    await table.clickToggle(0);\n\n    const runNowButton = await loader.getHarness(MatButtonHarness.with({ text: 'Run Now' }));\n    await runNowButton.click();\n\n    expect(spectator.inject(DialogService).confirm).toHaveBeenCalledWith({\n      title: 'Run Now',\n      message: 'Run this job now?',\n      hideCheckbox: true,\n    });\n\n    expect(spectator.inject(WebSocketService).call).toHaveBeenCalledWith('cronjob.run', [1]);\n  });\n\n  it('shows form to edit an existing interface when Edit button is pressed', async () => {\n    await table.clickToggle(0);\n\n    const editButton = await loader.getHarness(MatButtonHarness.with({ text: 'Edit' }));\n    await editButton.click();\n\n    expect(spectator.inject(IxChainedSlideInService).open).toHaveBeenCalledWith(\n      CronFormComponent,\n      false,\n      expect.objectContaining(cronJobs[0]),\n    );\n  });\n\n  it('deletes a cronjob with confirmation when Delete button is pressed', async () => {\n    await table.clickToggle(0);\n\n    const deleteIcon = await loader.getHarness(MatButtonHarness.with({ text: 'Delete' }));\n    await deleteIcon.click();\n\n    expect(spectator.inject(MatDialog).open).toHaveBeenCalledWith(CronDeleteDialogComponent, {\n      data: expect.objectContaining({ id: 1 }),\n    });\n  });\n});\n"],"version":3}