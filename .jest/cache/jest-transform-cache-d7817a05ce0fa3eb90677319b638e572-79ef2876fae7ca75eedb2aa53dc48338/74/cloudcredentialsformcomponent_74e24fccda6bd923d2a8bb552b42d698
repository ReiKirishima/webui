b8109dd07cc4b7b8f68c13ad136b33ea
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.CloudCredentialsFormComponent = void 0;
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const card_1 = require("@angular/material/card");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const requires_roles_directive_1 = require("app/directives/requires-roles/requires-roles.directive");
const cloudsync_provider_enum_1 = require("app/enums/cloudsync-provider.enum");
const role_enum_1 = require("app/enums/role.enum");
const cloud_credentials_1 = require("app/helptext/system/cloud-credentials");
const dialog_service_1 = require("app/modules/dialog/dialog.service");
const form_actions_component_1 = require("app/modules/forms/ix-forms/components/form-actions/form-actions.component");
const ix_fieldset_component_1 = require("app/modules/forms/ix-forms/components/ix-fieldset/ix-fieldset.component");
const ix_input_component_1 = require("app/modules/forms/ix-forms/components/ix-input/ix-input.component");
const ix_select_component_1 = require("app/modules/forms/ix-forms/components/ix-select/ix-select.component");
const chained_component_ref_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/chained-component-ref");
const ix_modal_header2_component_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/components/ix-modal-header2/ix-modal-header2.component");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const forbidden_values_validation_1 = require("app/modules/forms/ix-forms/validators/forbidden-values-validation/forbidden-values-validation");
const snackbar_service_1 = require("app/modules/snackbar/services/snackbar.service");
const test_directive_1 = require("app/modules/test-id/test.directive");
const cloudsync_provider_description_component_1 = require("app/pages/data-protection/cloudsync/cloudsync-provider-description/cloudsync-provider-description.component");
const cloudsync_provider_common_1 = require("app/pages/data-protection/cloudsync/cloudsync-wizard/steps/cloudsync-provider/cloudsync-provider.common");
const cloud_credential_service_1 = require("app/services/cloud-credential.service");
const error_handler_service_1 = require("app/services/error-handler.service");
const ws_service_1 = require("app/services/ws.service");
// TODO: Form is partially backend driven and partially hardcoded on the frontend.
let CloudCredentialsFormComponent = class CloudCredentialsFormComponent {
    constructor(ws, formBuilder, cdr, errorHandler, dialogService, formErrorHandler, translate, snackbarService, cloudCredentialService, chainedRef) {
        this.ws = ws;
        this.formBuilder = formBuilder;
        this.cdr = cdr;
        this.errorHandler = errorHandler;
        this.dialogService = dialogService;
        this.formErrorHandler = formErrorHandler;
        this.translate = translate;
        this.snackbarService = snackbarService;
        this.cloudCredentialService = cloudCredentialService;
        this.chainedRef = chainedRef;
        this.requiredRoles = [role_enum_1.Role.CloudSyncWrite];
        this.commonForm = this.formBuilder.group({
            name: ['Storj', forms_1.Validators.required],
            provider: [cloudsync_provider_enum_1.CloudSyncProviderName.Storj],
        });
        this.isLoading = false;
        this.providers = [];
        this.providerOptions = (0, rxjs_1.of)([]);
        this.forbiddenNames = [];
        this.credentials = [];
        this.helptext = cloud_credentials_1.helptextSystemCloudcredentials;
        const data = this.chainedRef.getData();
        this.existingCredential = data === null || data === void 0 ? void 0 : data.existingCredential;
        this.limitProviders = data === null || data === void 0 ? void 0 : data.providers;
        // Has to be earlier than potential `setCredentialsForEdit` call
        this.setFormEvents();
    }
    get showProviderDescription() {
        return this.commonForm.controls.provider.enabled
            && this.commonForm.controls.provider.value === cloudsync_provider_enum_1.CloudSyncProviderName.Storj;
    }
    get isNew() {
        return !this.existingCredential;
    }
    get selectedProvider() {
        var _a;
        return (_a = this.providers) === null || _a === void 0 ? void 0 : _a.find((provider) => {
            return provider.name === this.commonForm.controls.provider.value;
        });
    }
    get areActionsDisabled() {
        var _a, _b;
        return this.isLoading
            || this.commonForm.invalid
            || ((_b = (_a = this.providerForm) === null || _a === void 0 ? void 0 : _a.form) === null || _b === void 0 ? void 0 : _b.invalid);
    }
    ngOnInit() {
        this.loadProviders();
        if (this.existingCredential) {
            this.setCredentialsForEdit();
        }
    }
    setCredentialsForEdit() {
        this.commonForm.patchValue(this.existingCredential);
        if (this.providerForm) {
            this.providerForm.getFormSetter$().next(this.existingCredential.attributes);
        }
    }
    onSubmit() {
        this.isLoading = true;
        this.providerForm.beforeSubmit()
            .pipe((0, operators_1.switchMap)(() => {
            const payload = this.preparePayload();
            return this.isNew
                ? this.ws.call('cloudsync.credentials.create', [payload])
                : this.ws.call('cloudsync.credentials.update', [this.existingCredential.id, payload]);
        }), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: (response) => {
                this.isLoading = false;
                this.snackbarService.success(this.isNew
                    ? this.translate.instant('Cloud credential added.')
                    : this.translate.instant('Cloud credential updated.'));
                this.chainedRef.close({ response, error: null });
                this.cdr.markForCheck();
            },
            error: (error) => {
                // TODO: Errors for nested provider form will be shown in a modal. Can be improved.
                this.isLoading = false;
                this.formErrorHandler.handleWsFormError(error, this.commonForm);
                this.cdr.markForCheck();
            },
        });
        return false;
    }
    onVerify() {
        this.isLoading = true;
        this.providerForm.beforeSubmit()
            .pipe((0, operators_1.switchMap)(() => {
            const _a = this.preparePayload(), { name } = _a, payload = __rest(_a, ["name"]);
            return this.ws.call('cloudsync.credentials.verify', [payload]);
        }), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: (response) => {
                if (response.valid) {
                    this.snackbarService.success(this.translate.instant('The credentials are valid.'));
                }
                else {
                    this.dialogService.error({
                        title: this.translate.instant('Error'),
                        message: response.excerpt,
                        backtrace: response.error,
                    });
                }
                this.isLoading = false;
                this.cdr.markForCheck();
            },
            error: (error) => {
                this.isLoading = false;
                this.formErrorHandler.handleWsFormError(error, this.commonForm);
                this.cdr.markForCheck();
            },
        });
    }
    preparePayload() {
        const commonValues = this.commonForm.value;
        return {
            name: commonValues.name,
            provider: commonValues.provider,
            attributes: this.providerForm.getSubmitAttributes(),
        };
    }
    loadProviders() {
        this.isLoading = true;
        (0, rxjs_1.combineLatest)([
            this.cloudCredentialService.getProviders(),
            this.cloudCredentialService.getCloudSyncCredentials(),
        ])
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: ([providers, credentials]) => {
                var _a;
                if ((_a = this.limitProviders) === null || _a === void 0 ? void 0 : _a.length) {
                    providers = providers.filter((provider) => this.limitProviders.includes(provider.name));
                }
                this.providers = providers;
                this.providerOptions = (0, rxjs_1.of)(providers.map((provider) => ({
                    label: provider.title,
                    value: provider.name,
                })));
                this.credentials = credentials;
                this.setNamesInUseValidator(credentials);
                this.renderProviderForm();
                if (this.existingCredential) {
                    this.providerForm.getFormSetter$().next(this.existingCredential.attributes);
                }
                this.isLoading = false;
                this.cdr.markForCheck();
            },
            error: (error) => {
                this.isLoading = false;
                this.cdr.markForCheck();
                this.dialogService.error(this.errorHandler.parseError(error));
            },
        });
    }
    setFormEvents() {
        this.commonForm.controls.provider.valueChanges
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe(() => {
            this.renderProviderForm();
            this.setDefaultName();
        });
    }
    setNamesInUseValidator(credentials) {
        this.forbiddenNames = credentials.map((credential) => credential.name);
        this.commonForm.controls.name.addValidators((0, forbidden_values_validation_1.forbiddenValues)(this.forbiddenNames));
    }
    setDefaultName() {
        if (!this.isNew || this.commonForm.controls.name.touched) {
            return;
        }
        this.commonForm.controls.name.setValue((0, cloudsync_provider_common_1.getName)(this.selectedProvider.title, this.forbiddenNames));
    }
    renderProviderForm() {
        var _a;
        (_a = this.providerFormContainer) === null || _a === void 0 ? void 0 : _a.clear();
        if (!this.selectedProvider) {
            return;
        }
        const formClass = (0, cloudsync_provider_common_1.getProviderFormClass)(this.selectedProvider.name);
        const formRef = this.providerFormContainer.createComponent(formClass);
        formRef.instance.provider = this.selectedProvider;
        this.providerForm = formRef.instance;
    }
};
exports.CloudCredentialsFormComponent = CloudCredentialsFormComponent;
CloudCredentialsFormComponent.ctorParameters = () => [
    { type: ws_service_1.WebSocketService },
    { type: forms_1.FormBuilder },
    { type: core_1.ChangeDetectorRef },
    { type: error_handler_service_1.ErrorHandlerService },
    { type: dialog_service_1.DialogService },
    { type: form_error_handler_service_1.FormErrorHandlerService },
    { type: core_2.TranslateService },
    { type: snackbar_service_1.SnackbarService },
    { type: cloud_credential_service_1.CloudCredentialService },
    { type: chained_component_ref_1.ChainedRef }
];
CloudCredentialsFormComponent.propDecorators = {
    providerFormContainer: [{ type: core_1.ViewChild, args: ['providerFormContainer', { static: true, read: core_1.ViewContainerRef },] }]
};
exports.CloudCredentialsFormComponent = CloudCredentialsFormComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-cloud-credentials-form',
        template: require("./cloud-credentials-form.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            ix_modal_header2_component_1.IxModalHeader2Component,
            card_1.MatCard,
            card_1.MatCardContent,
            forms_1.ReactiveFormsModule,
            ix_fieldset_component_1.IxFieldsetComponent,
            ix_select_component_1.IxSelectComponent,
            cloudsync_provider_description_component_1.CloudSyncProviderDescriptionComponent,
            ix_input_component_1.IxInputComponent,
            form_actions_component_1.FormActionsComponent,
            requires_roles_directive_1.RequiresRolesDirective,
            button_1.MatButton,
            test_directive_1.TestDirective,
            core_2.TranslateModule,
        ],
    })
], CloudCredentialsFormComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL2NyZWRlbnRpYWxzL2JhY2t1cC1jcmVkZW50aWFscy9jbG91ZC1jcmVkZW50aWFscy1mb3JtL2Nsb3VkLWNyZWRlbnRpYWxzLWZvcm0uY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsd0NBT3VCO0FBQ3ZCLDBDQUE4RTtBQUM5RSxxREFBcUQ7QUFDckQsaURBQWlFO0FBQ2pFLHlEQUFxRTtBQUNyRSw4Q0FBd0U7QUFDeEUsK0JBQXlDO0FBQ3pDLDhDQUEyQztBQUMzQyxxR0FBZ0c7QUFDaEcsK0VBQTBFO0FBQzFFLG1EQUEyQztBQUMzQyw2RUFBbUc7QUFJbkcsc0VBQWtFO0FBQ2xFLHNIQUFpSDtBQUNqSCxtSEFBOEc7QUFDOUcsMEdBQXFHO0FBQ3JHLDZHQUF3RztBQUN4RyxtSEFBcUc7QUFDckcseUpBQW1KO0FBQ25KLCtHQUF5RztBQUN6RywrSUFBZ0k7QUFDaEkscUZBQWlGO0FBQ2pGLHVFQUFtRTtBQUluRSwwS0FBb0s7QUFDcEssdUpBQXdKO0FBQ3hKLG9GQUErRTtBQUMvRSw4RUFBeUU7QUFDekUsd0RBQTJEO0FBTzNELGtGQUFrRjtBQXVCM0UsSUFBTSw2QkFBNkIsR0FBbkMsTUFBTSw2QkFBNkI7SUFxQnhDLFlBQ1UsRUFBb0IsRUFDcEIsV0FBd0IsRUFDeEIsR0FBc0IsRUFDdEIsWUFBaUMsRUFDakMsYUFBNEIsRUFDNUIsZ0JBQXlDLEVBQ3pDLFNBQTJCLEVBQzNCLGVBQWdDLEVBQ2hDLHNCQUE4QyxFQUM5QyxVQUFnRDtRQVRoRCxPQUFFLEdBQUYsRUFBRSxDQUFrQjtRQUNwQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQUN0QixpQkFBWSxHQUFaLFlBQVksQ0FBcUI7UUFDakMsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUF5QjtRQUN6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LFFBQVEsR0FBRyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7UUFDbEQsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQ3ZDLENBQUM7O0FBak9VLHNFQUE2Qjs7Ozs7Ozs7Ozs7Ozs7b0NBaUJ2QyxnQkFBUyxTQUFDLHVCQUF1QixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsdUJBQWdCLEVBQUU7O3dDQWpCakUsNkJBQTZCO0lBdEJ6QyxJQUFBLDRCQUFZLEdBQUU7SUFDZCxJQUFBLGdCQUFTLEVBQUM7UUFDVCxRQUFRLEVBQUUsMkJBQTJCO1FBQ3JDLDREQUFzRDtRQUN0RCxlQUFlLEVBQUUsOEJBQXVCLENBQUMsTUFBTTtRQUMvQyxVQUFVLEVBQUUsSUFBSTtRQUNoQixPQUFPLEVBQUU7WUFDUCxvREFBdUI7WUFDdkIsY0FBTztZQUNQLHFCQUFjO1lBQ2QsMkJBQW1CO1lBQ25CLDJDQUFtQjtZQUNuQix1Q0FBaUI7WUFDakIsZ0ZBQXFDO1lBQ3JDLHFDQUFnQjtZQUNoQiw2Q0FBb0I7WUFDcEIsaURBQXNCO1lBQ3RCLGtCQUFTO1lBQ1QsOEJBQWE7WUFDYixzQkFBZTtTQUNoQjtLQUNGLENBQUM7R0FDVyw2QkFBNkIsQ0FrT3pDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9wYWdlcy9jcmVkZW50aWFscy9iYWNrdXAtY3JlZGVudGlhbHMvY2xvdWQtY3JlZGVudGlhbHMtZm9ybS9jbG91ZC1jcmVkZW50aWFscy1mb3JtLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIFZhbGlkYXRvcnMsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRCdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xuaW1wb3J0IHsgTWF0Q2FyZCwgTWF0Q2FyZENvbnRlbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9jYXJkJztcbmltcG9ydCB7IFVudGlsRGVzdHJveSwgdW50aWxEZXN0cm95ZWQgfSBmcm9tICdAbmduZWF0L3VudGlsLWRlc3Ryb3knO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSwgVHJhbnNsYXRlTW9kdWxlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBjb21iaW5lTGF0ZXN0LCBvZiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUmVxdWlyZXNSb2xlc0RpcmVjdGl2ZSB9IGZyb20gJ2FwcC9kaXJlY3RpdmVzL3JlcXVpcmVzLXJvbGVzL3JlcXVpcmVzLXJvbGVzLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBDbG91ZFN5bmNQcm92aWRlck5hbWUgfSBmcm9tICdhcHAvZW51bXMvY2xvdWRzeW5jLXByb3ZpZGVyLmVudW0nO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJ2FwcC9lbnVtcy9yb2xlLmVudW0nO1xuaW1wb3J0IHsgaGVscHRleHRTeXN0ZW1DbG91ZGNyZWRlbnRpYWxzIGFzIGhlbHB0ZXh0IH0gZnJvbSAnYXBwL2hlbHB0ZXh0L3N5c3RlbS9jbG91ZC1jcmVkZW50aWFscyc7XG5pbXBvcnQgeyBDbG91ZFN5bmNDcmVkZW50aWFsLCBDbG91ZFN5bmNDcmVkZW50aWFsVXBkYXRlIH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvY2xvdWRzeW5jLWNyZWRlbnRpYWwuaW50ZXJmYWNlJztcbmltcG9ydCB7IENsb3VkU3luY1Byb3ZpZGVyIH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvY2xvdWRzeW5jLXByb3ZpZGVyLmludGVyZmFjZSc7XG5pbXBvcnQgeyBPcHRpb24gfSBmcm9tICdhcHAvaW50ZXJmYWNlcy9vcHRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9kaWFsb2cvZGlhbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybUFjdGlvbnNDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2Zvcm0tYWN0aW9ucy9mb3JtLWFjdGlvbnMuY29tcG9uZW50JztcbmltcG9ydCB7IEl4RmllbGRzZXRDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LWZpZWxkc2V0L2l4LWZpZWxkc2V0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeElucHV0Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1pbnB1dC9peC1pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhTZWxlY3RDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LXNlbGVjdC9peC1zZWxlY3QuY29tcG9uZW50JztcbmltcG9ydCB7IENoYWluZWRSZWYgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LXNsaWRlLWluL2NoYWluZWQtY29tcG9uZW50LXJlZic7XG5pbXBvcnQgeyBJeE1vZGFsSGVhZGVyMkNvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vY29tcG9uZW50cy9peC1tb2RhbC1oZWFkZXIyL2l4LW1vZGFsLWhlYWRlcjIuY29tcG9uZW50JztcbmltcG9ydCB7IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvc2VydmljZXMvZm9ybS1lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgZm9yYmlkZGVuVmFsdWVzIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvdmFsaWRhdG9ycy9mb3JiaWRkZW4tdmFsdWVzLXZhbGlkYXRpb24vZm9yYmlkZGVuLXZhbHVlcy12YWxpZGF0aW9uJztcbmltcG9ydCB7IFNuYWNrYmFyU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3NuYWNrYmFyL3NlcnZpY2VzL3NuYWNrYmFyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGVzdERpcmVjdGl2ZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3Rlc3QtaWQvdGVzdC5kaXJlY3RpdmUnO1xuaW1wb3J0IHtcbiAgQmFzZVByb3ZpZGVyRm9ybUNvbXBvbmVudCxcbn0gZnJvbSAnYXBwL3BhZ2VzL2NyZWRlbnRpYWxzL2JhY2t1cC1jcmVkZW50aWFscy9jbG91ZC1jcmVkZW50aWFscy1mb3JtL3Byb3ZpZGVyLWZvcm1zL2Jhc2UtcHJvdmlkZXItZm9ybSc7XG5pbXBvcnQgeyBDbG91ZFN5bmNQcm92aWRlckRlc2NyaXB0aW9uQ29tcG9uZW50IH0gZnJvbSAnYXBwL3BhZ2VzL2RhdGEtcHJvdGVjdGlvbi9jbG91ZHN5bmMvY2xvdWRzeW5jLXByb3ZpZGVyLWRlc2NyaXB0aW9uL2Nsb3Vkc3luYy1wcm92aWRlci1kZXNjcmlwdGlvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgZ2V0TmFtZSwgZ2V0UHJvdmlkZXJGb3JtQ2xhc3MgfSBmcm9tICdhcHAvcGFnZXMvZGF0YS1wcm90ZWN0aW9uL2Nsb3Vkc3luYy9jbG91ZHN5bmMtd2l6YXJkL3N0ZXBzL2Nsb3Vkc3luYy1wcm92aWRlci9jbG91ZHN5bmMtcHJvdmlkZXIuY29tbW9uJztcbmltcG9ydCB7IENsb3VkQ3JlZGVudGlhbFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvY2xvdWQtY3JlZGVudGlhbC5zZXJ2aWNlJztcbmltcG9ydCB7IEVycm9ySGFuZGxlclNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvZXJyb3ItaGFuZGxlci5zZXJ2aWNlJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvd3Muc2VydmljZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2xvdWRDcmVkZW50aWFsRm9ybUlucHV0IHtcbiAgcHJvdmlkZXJzOiBDbG91ZFN5bmNQcm92aWRlck5hbWVbXTtcbiAgZXhpc3RpbmdDcmVkZW50aWFsOiBDbG91ZFN5bmNDcmVkZW50aWFsO1xufVxuXG4vLyBUT0RPOiBGb3JtIGlzIHBhcnRpYWxseSBiYWNrZW5kIGRyaXZlbiBhbmQgcGFydGlhbGx5IGhhcmRjb2RlZCBvbiB0aGUgZnJvbnRlbmQuXG5AVW50aWxEZXN0cm95KClcbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2l4LWNsb3VkLWNyZWRlbnRpYWxzLWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJy4vY2xvdWQtY3JlZGVudGlhbHMtZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgSXhNb2RhbEhlYWRlcjJDb21wb25lbnQsXG4gICAgTWF0Q2FyZCxcbiAgICBNYXRDYXJkQ29udGVudCxcbiAgICBSZWFjdGl2ZUZvcm1zTW9kdWxlLFxuICAgIEl4RmllbGRzZXRDb21wb25lbnQsXG4gICAgSXhTZWxlY3RDb21wb25lbnQsXG4gICAgQ2xvdWRTeW5jUHJvdmlkZXJEZXNjcmlwdGlvbkNvbXBvbmVudCxcbiAgICBJeElucHV0Q29tcG9uZW50LFxuICAgIEZvcm1BY3Rpb25zQ29tcG9uZW50LFxuICAgIFJlcXVpcmVzUm9sZXNEaXJlY3RpdmUsXG4gICAgTWF0QnV0dG9uLFxuICAgIFRlc3REaXJlY3RpdmUsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBDbG91ZENyZWRlbnRpYWxzRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByb3RlY3RlZCByZWFkb25seSByZXF1aXJlZFJvbGVzID0gW1JvbGUuQ2xvdWRTeW5jV3JpdGVdO1xuXG4gIGNvbW1vbkZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICBuYW1lOiBbJ1N0b3JqJywgVmFsaWRhdG9ycy5yZXF1aXJlZF0sXG4gICAgcHJvdmlkZXI6IFtDbG91ZFN5bmNQcm92aWRlck5hbWUuU3RvcmpdLFxuICB9KTtcblxuICBpc0xvYWRpbmcgPSBmYWxzZTtcbiAgZXhpc3RpbmdDcmVkZW50aWFsOiBDbG91ZFN5bmNDcmVkZW50aWFsO1xuICBsaW1pdFByb3ZpZGVyczogQ2xvdWRTeW5jUHJvdmlkZXJOYW1lW107XG4gIHByb3ZpZGVyczogQ2xvdWRTeW5jUHJvdmlkZXJbXSA9IFtdO1xuICBwcm92aWRlck9wdGlvbnMgPSBvZjxPcHRpb25bXT4oW10pO1xuICBwcm92aWRlckZvcm06IEJhc2VQcm92aWRlckZvcm1Db21wb25lbnQ7XG4gIGZvcmJpZGRlbk5hbWVzOiBzdHJpbmdbXSA9IFtdO1xuICBjcmVkZW50aWFsczogQ2xvdWRTeW5jQ3JlZGVudGlhbFtdID0gW107XG5cbiAgQFZpZXdDaGlsZCgncHJvdmlkZXJGb3JtQ29udGFpbmVyJywgeyBzdGF0aWM6IHRydWUsIHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSkgcHJvdmlkZXJGb3JtQ29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xuXG4gIHJlYWRvbmx5IGhlbHB0ZXh0ID0gaGVscHRleHQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB3czogV2ViU29ja2V0U2VydmljZSxcbiAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcixcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgZm9ybUVycm9ySGFuZGxlcjogRm9ybUVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzbmFja2JhclNlcnZpY2U6IFNuYWNrYmFyU2VydmljZSxcbiAgICBwcml2YXRlIGNsb3VkQ3JlZGVudGlhbFNlcnZpY2U6IENsb3VkQ3JlZGVudGlhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjaGFpbmVkUmVmOiBDaGFpbmVkUmVmPENsb3VkQ3JlZGVudGlhbEZvcm1JbnB1dD4sXG4gICkge1xuICAgIGNvbnN0IGRhdGEgPSB0aGlzLmNoYWluZWRSZWYuZ2V0RGF0YSgpO1xuICAgIHRoaXMuZXhpc3RpbmdDcmVkZW50aWFsID0gZGF0YT8uZXhpc3RpbmdDcmVkZW50aWFsO1xuICAgIHRoaXMubGltaXRQcm92aWRlcnMgPSBkYXRhPy5wcm92aWRlcnM7XG4gICAgLy8gSGFzIHRvIGJlIGVhcmxpZXIgdGhhbiBwb3RlbnRpYWwgYHNldENyZWRlbnRpYWxzRm9yRWRpdGAgY2FsbFxuICAgIHRoaXMuc2V0Rm9ybUV2ZW50cygpO1xuICB9XG5cbiAgZ2V0IHNob3dQcm92aWRlckRlc2NyaXB0aW9uKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNvbW1vbkZvcm0uY29udHJvbHMucHJvdmlkZXIuZW5hYmxlZFxuICAgICAgJiYgdGhpcy5jb21tb25Gb3JtLmNvbnRyb2xzLnByb3ZpZGVyLnZhbHVlID09PSBDbG91ZFN5bmNQcm92aWRlck5hbWUuU3Rvcmo7XG4gIH1cblxuICBnZXQgaXNOZXcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLmV4aXN0aW5nQ3JlZGVudGlhbDtcbiAgfVxuXG4gIGdldCBzZWxlY3RlZFByb3ZpZGVyKCk6IENsb3VkU3luY1Byb3ZpZGVyIHtcbiAgICByZXR1cm4gdGhpcy5wcm92aWRlcnM/LmZpbmQoKHByb3ZpZGVyKSA9PiB7XG4gICAgICByZXR1cm4gcHJvdmlkZXIubmFtZSA9PT0gdGhpcy5jb21tb25Gb3JtLmNvbnRyb2xzLnByb3ZpZGVyLnZhbHVlO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0IGFyZUFjdGlvbnNEaXNhYmxlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5pc0xvYWRpbmdcbiAgICAgIHx8IHRoaXMuY29tbW9uRm9ybS5pbnZhbGlkXG4gICAgICB8fCB0aGlzLnByb3ZpZGVyRm9ybT8uZm9ybT8uaW52YWxpZDtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIHRoaXMubG9hZFByb3ZpZGVycygpO1xuXG4gICAgaWYgKHRoaXMuZXhpc3RpbmdDcmVkZW50aWFsKSB7XG4gICAgICB0aGlzLnNldENyZWRlbnRpYWxzRm9yRWRpdCgpO1xuICAgIH1cbiAgfVxuXG4gIHNldENyZWRlbnRpYWxzRm9yRWRpdCgpOiB2b2lkIHtcbiAgICB0aGlzLmNvbW1vbkZvcm0ucGF0Y2hWYWx1ZSh0aGlzLmV4aXN0aW5nQ3JlZGVudGlhbCk7XG5cbiAgICBpZiAodGhpcy5wcm92aWRlckZvcm0pIHtcbiAgICAgIHRoaXMucHJvdmlkZXJGb3JtLmdldEZvcm1TZXR0ZXIkKCkubmV4dCh0aGlzLmV4aXN0aW5nQ3JlZGVudGlhbC5hdHRyaWJ1dGVzKTtcbiAgICB9XG4gIH1cblxuICBvblN1Ym1pdCgpOiBib29sZWFuIHtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICB0aGlzLnByb3ZpZGVyRm9ybS5iZWZvcmVTdWJtaXQoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHRoaXMucHJlcGFyZVBheWxvYWQoKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5pc05ld1xuICAgICAgICAgICAgPyB0aGlzLndzLmNhbGwoJ2Nsb3Vkc3luYy5jcmVkZW50aWFscy5jcmVhdGUnLCBbcGF5bG9hZF0pXG4gICAgICAgICAgICA6IHRoaXMud3MuY2FsbCgnY2xvdWRzeW5jLmNyZWRlbnRpYWxzLnVwZGF0ZScsIFt0aGlzLmV4aXN0aW5nQ3JlZGVudGlhbC5pZCwgcGF5bG9hZF0pO1xuICAgICAgICB9KSxcbiAgICAgICAgdW50aWxEZXN0cm95ZWQodGhpcyksXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnNuYWNrYmFyU2VydmljZS5zdWNjZXNzKFxuICAgICAgICAgICAgdGhpcy5pc05ld1xuICAgICAgICAgICAgICA/IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0Nsb3VkIGNyZWRlbnRpYWwgYWRkZWQuJylcbiAgICAgICAgICAgICAgOiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdDbG91ZCBjcmVkZW50aWFsIHVwZGF0ZWQuJyksXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0aGlzLmNoYWluZWRSZWYuY2xvc2UoeyByZXNwb25zZSwgZXJyb3I6IG51bGwgfSk7XG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiAoZXJyb3I6IHVua25vd24pID0+IHtcbiAgICAgICAgICAvLyBUT0RPOiBFcnJvcnMgZm9yIG5lc3RlZCBwcm92aWRlciBmb3JtIHdpbGwgYmUgc2hvd24gaW4gYSBtb2RhbC4gQ2FuIGJlIGltcHJvdmVkLlxuICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5mb3JtRXJyb3JIYW5kbGVyLmhhbmRsZVdzRm9ybUVycm9yKGVycm9yLCB0aGlzLmNvbW1vbkZvcm0pO1xuICAgICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBvblZlcmlmeSgpOiB2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG5cbiAgICB0aGlzLnByb3ZpZGVyRm9ybS5iZWZvcmVTdWJtaXQoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lLCAuLi5wYXlsb2FkIH0gPSB0aGlzLnByZXBhcmVQYXlsb2FkKCk7XG5cbiAgICAgICAgICByZXR1cm4gdGhpcy53cy5jYWxsKCdjbG91ZHN5bmMuY3JlZGVudGlhbHMudmVyaWZ5JywgW3BheWxvYWRdKTtcbiAgICAgICAgfSksXG4gICAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIGlmIChyZXNwb25zZS52YWxpZCkge1xuICAgICAgICAgICAgdGhpcy5zbmFja2JhclNlcnZpY2Uuc3VjY2Vzcyh0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdUaGUgY3JlZGVudGlhbHMgYXJlIHZhbGlkLicpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kaWFsb2dTZXJ2aWNlLmVycm9yKHtcbiAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0Vycm9yJyksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLmV4Y2VycHQsXG4gICAgICAgICAgICAgIGJhY2t0cmFjZTogcmVzcG9uc2UuZXJyb3IsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogKGVycm9yOiB1bmtub3duKSA9PiB7XG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmZvcm1FcnJvckhhbmRsZXIuaGFuZGxlV3NGb3JtRXJyb3IoZXJyb3IsIHRoaXMuY29tbW9uRm9ybSk7XG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcHJlcGFyZVBheWxvYWQoKTogQ2xvdWRTeW5jQ3JlZGVudGlhbFVwZGF0ZSB7XG4gICAgY29uc3QgY29tbW9uVmFsdWVzID0gdGhpcy5jb21tb25Gb3JtLnZhbHVlO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBjb21tb25WYWx1ZXMubmFtZSxcbiAgICAgIHByb3ZpZGVyOiBjb21tb25WYWx1ZXMucHJvdmlkZXIsXG4gICAgICBhdHRyaWJ1dGVzOiB0aGlzLnByb3ZpZGVyRm9ybS5nZXRTdWJtaXRBdHRyaWJ1dGVzKCksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZFByb3ZpZGVycygpOiB2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgY29tYmluZUxhdGVzdChbXG4gICAgICB0aGlzLmNsb3VkQ3JlZGVudGlhbFNlcnZpY2UuZ2V0UHJvdmlkZXJzKCksXG4gICAgICB0aGlzLmNsb3VkQ3JlZGVudGlhbFNlcnZpY2UuZ2V0Q2xvdWRTeW5jQ3JlZGVudGlhbHMoKSxcbiAgICBdKVxuICAgICAgLnBpcGUodW50aWxEZXN0cm95ZWQodGhpcykpXG4gICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKFtwcm92aWRlcnMsIGNyZWRlbnRpYWxzXSkgPT4ge1xuICAgICAgICAgIGlmICh0aGlzLmxpbWl0UHJvdmlkZXJzPy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHByb3ZpZGVycyA9IHByb3ZpZGVycy5maWx0ZXIoKHByb3ZpZGVyKSA9PiB0aGlzLmxpbWl0UHJvdmlkZXJzLmluY2x1ZGVzKHByb3ZpZGVyLm5hbWUpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5wcm92aWRlcnMgPSBwcm92aWRlcnM7XG4gICAgICAgICAgdGhpcy5wcm92aWRlck9wdGlvbnMgPSBvZihcbiAgICAgICAgICAgIHByb3ZpZGVycy5tYXAoKHByb3ZpZGVyKSA9PiAoe1xuICAgICAgICAgICAgICBsYWJlbDogcHJvdmlkZXIudGl0bGUsXG4gICAgICAgICAgICAgIHZhbHVlOiBwcm92aWRlci5uYW1lLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5jcmVkZW50aWFscyA9IGNyZWRlbnRpYWxzO1xuICAgICAgICAgIHRoaXMuc2V0TmFtZXNJblVzZVZhbGlkYXRvcihjcmVkZW50aWFscyk7XG4gICAgICAgICAgdGhpcy5yZW5kZXJQcm92aWRlckZvcm0oKTtcbiAgICAgICAgICBpZiAodGhpcy5leGlzdGluZ0NyZWRlbnRpYWwpIHtcbiAgICAgICAgICAgIHRoaXMucHJvdmlkZXJGb3JtLmdldEZvcm1TZXR0ZXIkKCkubmV4dCh0aGlzLmV4aXN0aW5nQ3JlZGVudGlhbC5hdHRyaWJ1dGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IChlcnJvcjogdW5rbm93bikgPT4ge1xuICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgdGhpcy5kaWFsb2dTZXJ2aWNlLmVycm9yKHRoaXMuZXJyb3JIYW5kbGVyLnBhcnNlRXJyb3IoZXJyb3IpKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRGb3JtRXZlbnRzKCk6IHZvaWQge1xuICAgIHRoaXMuY29tbW9uRm9ybS5jb250cm9scy5wcm92aWRlci52YWx1ZUNoYW5nZXNcbiAgICAgIC5waXBlKHVudGlsRGVzdHJveWVkKHRoaXMpKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMucmVuZGVyUHJvdmlkZXJGb3JtKCk7XG5cbiAgICAgICAgdGhpcy5zZXREZWZhdWx0TmFtZSgpO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldE5hbWVzSW5Vc2VWYWxpZGF0b3IoY3JlZGVudGlhbHM6IENsb3VkU3luY0NyZWRlbnRpYWxbXSk6IHZvaWQge1xuICAgIHRoaXMuZm9yYmlkZGVuTmFtZXMgPSBjcmVkZW50aWFscy5tYXAoKGNyZWRlbnRpYWwpID0+IGNyZWRlbnRpYWwubmFtZSk7XG4gICAgdGhpcy5jb21tb25Gb3JtLmNvbnRyb2xzLm5hbWUuYWRkVmFsaWRhdG9ycyhmb3JiaWRkZW5WYWx1ZXModGhpcy5mb3JiaWRkZW5OYW1lcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXREZWZhdWx0TmFtZSgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuaXNOZXcgfHwgdGhpcy5jb21tb25Gb3JtLmNvbnRyb2xzLm5hbWUudG91Y2hlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuY29tbW9uRm9ybS5jb250cm9scy5uYW1lLnNldFZhbHVlKGdldE5hbWUodGhpcy5zZWxlY3RlZFByb3ZpZGVyLnRpdGxlLCB0aGlzLmZvcmJpZGRlbk5hbWVzKSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclByb3ZpZGVyRm9ybSgpOiB2b2lkIHtcbiAgICB0aGlzLnByb3ZpZGVyRm9ybUNvbnRhaW5lcj8uY2xlYXIoKTtcbiAgICBpZiAoIXRoaXMuc2VsZWN0ZWRQcm92aWRlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGZvcm1DbGFzcyA9IGdldFByb3ZpZGVyRm9ybUNsYXNzKHRoaXMuc2VsZWN0ZWRQcm92aWRlci5uYW1lKTtcbiAgICBjb25zdCBmb3JtUmVmID0gdGhpcy5wcm92aWRlckZvcm1Db250YWluZXIuY3JlYXRlQ29tcG9uZW50KGZvcm1DbGFzcyk7XG4gICAgZm9ybVJlZi5pbnN0YW5jZS5wcm92aWRlciA9IHRoaXMuc2VsZWN0ZWRQcm92aWRlcjtcbiAgICB0aGlzLnByb3ZpZGVyRm9ybSA9IGZvcm1SZWYuaW5zdGFuY2U7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==