{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/directives/form-change-guard/form-change-guard-for-slide-in.directive.spec.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/directives/form-change-guard/form-change-guard-for-slide-in.directive.spec.ts"],"sourcesContent":["import { FormGroup, ReactiveFormsModule } from '@angular/forms';\nimport {\n  createHostFactory, SpectatorHost, mockProvider,\n} from '@ngneat/spectator/jest';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Observable, of } from 'rxjs';\nimport { DialogWithSecondaryCheckboxResult } from 'app/interfaces/dialog.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { IxSlideInRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref';\nimport { FormChangeGuardForSlideInDirective } from './form-change-guard-for-slide-in.directive';\n\ndescribe('FormChangeGuardForSlideInDirective', () => {\n  let spectator: SpectatorHost<FormChangeGuardForSlideInDirective<unknown>>;\n\n  const createHost = createHostFactory({\n    component: FormChangeGuardForSlideInDirective,\n    imports: [ReactiveFormsModule],\n    providers: [\n      mockProvider(DialogService, {\n        confirm: jest.fn(() => of(true)),\n      }),\n      mockProvider(TranslateService, {\n        instant: jest.fn((key: string) => key),\n      }),\n      {\n        provide: IxSlideInRef,\n        useFactory: () => ({\n          close: jest.fn(),\n        }),\n      },\n    ],\n  });\n\n  beforeEach(() => {\n    spectator = createHost(`\n      <form [formGroup]=\"form\" formChangeGuardForSlideIn></form>\n    `, {\n      hostProps: {\n        form: new FormGroup({}),\n      },\n    });\n  });\n\n  it('should set formChanged to true when form value changes', () => {\n    spectator.component.formGroup.markAsPristine();\n\n    spectator.component.formGroup.valueChanges.subscribe(() => {\n      expect(spectator.component.formChanged).toBe(true);\n    });\n  });\n\n  it('should emit close event if there are no unsaved changes', () => {\n    spectator.component.formChanged = false;\n\n    spectator.detectChanges();\n\n    spectator.component.closeWithConfirmation().subscribe((shouldClose) => {\n      expect(shouldClose).toBe(true);\n    });\n  });\n\n  it('should call confirmation dialog if there are unsaved changes', () => {\n    const dialogService = spectator.inject(DialogService);\n\n    spectator.component.closeWithConfirmation().subscribe(() => {\n      expect(dialogService.confirm).toHaveBeenCalled();\n    });\n  });\n\n  it('should reset formChanged to false after confirmation', () => {\n    const slideInRef = spectator.inject(IxSlideInRef);\n    const dialogService = spectator.inject(DialogService);\n\n    spectator.component.formChanged = true;\n\n    jest.spyOn(dialogService, 'confirm').mockReturnValue(of(true) as unknown as Observable<DialogWithSecondaryCheckboxResult>);\n\n    spectator.component.closeWithConfirmation().subscribe((shouldClose) => {\n      expect(shouldClose).toBe(true);\n    });\n  });\n\n  it('should not emit close event if confirmation is rejected', () => {\n    const slideInRef = spectator.inject(IxSlideInRef);\n    const dialogService = spectator.inject(DialogService);\n\n    jest.spyOn(dialogService, 'confirm').mockReturnValue(of(true) as unknown as Observable<DialogWithSecondaryCheckboxResult>);\n\n    spectator.component.closeWithConfirmation().subscribe((shouldClose) => {\n      expect(shouldClose).toBe(false);\n      expect(slideInRef.close).not.toHaveBeenCalled();\n    });\n  });\n});\n"],"version":3}