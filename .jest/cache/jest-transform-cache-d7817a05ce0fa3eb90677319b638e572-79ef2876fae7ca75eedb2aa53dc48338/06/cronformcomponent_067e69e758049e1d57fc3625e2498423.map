{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/advanced/cron/cron-form/cron-form.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/advanced/cron/cron-form/cron-form.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit,\n} from '@angular/core';\nimport { FormBuilder, Validators, ReactiveFormsModule } from '@angular/forms';\nimport { MatButton } from '@angular/material/button';\nimport { MatCard, MatCardContent } from '@angular/material/card';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\nimport { Observable } from 'rxjs';\nimport { RequiresRolesDirective } from 'app/directives/requires-roles/requires-roles.directive';\nimport { Role } from 'app/enums/role.enum';\nimport { helptextCron } from 'app/helptext/system/cron-form';\nimport { Cronjob, CronjobUpdate } from 'app/interfaces/cronjob.interface';\nimport { UserComboboxProvider } from 'app/modules/forms/ix-forms/classes/user-combobox-provider';\nimport { FormActionsComponent } from 'app/modules/forms/ix-forms/components/form-actions/form-actions.component';\nimport { IxCheckboxComponent } from 'app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component';\nimport { IxComboboxComponent } from 'app/modules/forms/ix-forms/components/ix-combobox/ix-combobox.component';\nimport { IxFieldsetComponent } from 'app/modules/forms/ix-forms/components/ix-fieldset/ix-fieldset.component';\nimport { IxInputComponent } from 'app/modules/forms/ix-forms/components/ix-input/ix-input.component';\nimport { ChainedRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/chained-component-ref';\nimport { IxModalHeader2Component } from 'app/modules/forms/ix-forms/components/ix-slide-in/components/ix-modal-header2/ix-modal-header2.component';\nimport { FormErrorHandlerService } from 'app/modules/forms/ix-forms/services/form-error-handler.service';\nimport { SchedulerModule } from 'app/modules/scheduler/scheduler.module';\nimport { crontabToSchedule } from 'app/modules/scheduler/utils/crontab-to-schedule.utils';\nimport { CronPresetValue } from 'app/modules/scheduler/utils/get-default-crontab-presets.utils';\nimport { scheduleToCrontab } from 'app/modules/scheduler/utils/schedule-to-crontab.utils';\nimport { SnackbarService } from 'app/modules/snackbar/services/snackbar.service';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { UserService } from 'app/services/user.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-cron-form',\n  templateUrl: './cron-form.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    IxModalHeader2Component,\n    MatCard,\n    MatCardContent,\n    ReactiveFormsModule,\n    IxFieldsetComponent,\n    IxInputComponent,\n    IxComboboxComponent,\n    SchedulerModule,\n    IxCheckboxComponent,\n    FormActionsComponent,\n    RequiresRolesDirective,\n    MatButton,\n    TestDirective,\n    TranslateModule,\n  ],\n})\nexport class CronFormComponent implements OnInit {\n  protected readonly requiredRoles = [Role.FullAdmin];\n\n  get isNew(): boolean {\n    return !this.editingCron;\n  }\n\n  get title(): string {\n    return this.isNew\n      ? this.translate.instant('Add Cron Job')\n      : this.translate.instant('Edit Cron Job');\n  }\n\n  form = this.fb.group({\n    description: [''],\n    command: ['', Validators.required],\n    user: ['', Validators.required],\n    schedule: [CronPresetValue.Daily as string, Validators.required],\n    stdout: [true],\n    stderr: [false],\n    enabled: [true],\n  });\n\n  isLoading = false;\n\n  readonly tooltips = {\n    description: helptextCron.cron_description_tooltip,\n    command: helptextCron.cron_command_tooltip,\n    user: helptextCron.cron_user_tooltip,\n    schedule: helptextCron.crontab_tooltip,\n    stdout: helptextCron.cron_stdout_tooltip,\n    stderr: helptextCron.cron_stderr_tooltip,\n    enabled: helptextCron.cron_enabled_tooltip,\n  };\n\n  readonly userProvider = new UserComboboxProvider(this.userService);\n\n  private editingCron: Cronjob;\n\n  constructor(\n    private fb: FormBuilder,\n    private ws: WebSocketService,\n    private translate: TranslateService,\n    private errorHandler: FormErrorHandlerService,\n    private cdr: ChangeDetectorRef,\n    private snackbar: SnackbarService,\n    private userService: UserService,\n    private chainedRef: ChainedRef<Cronjob>,\n  ) {\n    this.editingCron = this.chainedRef.getData();\n  }\n\n  ngOnInit(): void {\n    if (this.editingCron) {\n      this.setCronForEdit();\n    }\n  }\n\n  setCronForEdit(): void {\n    this.form.patchValue({\n      ...this.editingCron,\n      schedule: scheduleToCrontab(this.editingCron.schedule),\n    });\n  }\n\n  onSubmit(): void {\n    const values = {\n      ...this.form.value,\n      schedule: crontabToSchedule(this.form.value.schedule),\n    } as CronjobUpdate;\n\n    this.isLoading = true;\n    let request$: Observable<unknown>;\n    if (this.isNew) {\n      request$ = this.ws.call('cronjob.create', [values]);\n    } else {\n      request$ = this.ws.call('cronjob.update', [\n        this.editingCron.id,\n        values,\n      ]);\n    }\n\n    request$.pipe(untilDestroyed(this)).subscribe({\n      next: () => {\n        if (this.isNew) {\n          this.snackbar.success(this.translate.instant('Cron job created'));\n        } else {\n          this.snackbar.success(this.translate.instant('Cron job updated'));\n        }\n        this.isLoading = false;\n        this.chainedRef.close({ response: true, error: null });\n      },\n      error: (error: unknown) => {\n        this.isLoading = false;\n        this.errorHandler.handleWsFormError(error, this.form);\n        this.cdr.markForCheck();\n      },\n    });\n  }\n}\n"],"version":3}