409ed8b65f07e7ed0c863177648529ac
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.maxDecimals = void 0;
exports.formatData = formatData;
exports.inferUnits = inferUnits;
exports.convertKmgt = convertKmgt;
exports.convertByKilobits = convertByKilobits;
exports.convertByThousands = convertByThousands;
exports.formatValue = formatValue;
exports.convertAggregations = convertAggregations;
exports.optimizeLegend = optimizeLegend;
const bytes_constant_1 = require("app/constants/bytes.constant");
const reporting_enum_1 = require("app/enums/reporting.enum");
const object_keys_to_human_readable_helper_1 = require("app/helpers/object-keys-to-human-readable.helper");
function formatData(data) {
    const formattedData = Object.assign({}, data);
    if (formattedData.name === reporting_enum_1.ReportingGraphName.NetworkInterface
        && formattedData.aggregations) {
        delete formattedData.aggregations.min;
    }
    if (formattedData.name === reporting_enum_1.ReportingGraphName.Cpu) {
        formattedData.legend = [...formattedData.legend].reverse();
        formattedData.data = formattedData.data.map((row) => [
            row[0],
            ...row.slice(1).reverse(),
        ]);
        if (formattedData.aggregations) {
            formattedData.aggregations.min = [...formattedData.aggregations.min].reverse();
            formattedData.aggregations.max = [...formattedData.aggregations.max].reverse();
            formattedData.aggregations.mean = [...formattedData.aggregations.mean].reverse();
        }
    }
    return formattedData;
}
const maxDecimals = (input, max = 2) => {
    const str = input.toString().split('.');
    if (!str[1]) {
        // Not a float
        return input;
    }
    const decimals = str[1].length;
    const output = decimals > max ? input.toFixed(max) : input;
    const prepareInput = parseFloat(output);
    return prepareInput < 1000 ? Number(prepareInput.toString().slice(0, 4)) : Math.round(prepareInput);
};
exports.maxDecimals = maxDecimals;
function inferUnits(label) {
    const lowerLabel = label.toLowerCase();
    if (label.includes('%') || lowerLabel.includes('percentage'))
        return '%';
    if (label.includes('°') || lowerLabel.includes('celsius'))
        return '°';
    if (lowerLabel.includes('mebibytes'))
        return 'mebibytes';
    if (lowerLabel.includes('kibibytes'))
        return 'kibibytes';
    if (lowerLabel.includes('kilobits'))
        return 'kilobits';
    if (lowerLabel.includes('bytes'))
        return 'bytes';
    if (lowerLabel.includes('bits'))
        return 'bits';
    console.warn('Could not infer units from ' + label);
    return label;
}
function convertKmgt(input, units) {
    const unitsMap = [
        { threshold: bytes_constant_1.TiB, prefix: 'Tebi', shortName: 'TiB' },
        { threshold: bytes_constant_1.GiB, prefix: 'Gibi', shortName: 'GiB' },
        { threshold: bytes_constant_1.MiB, prefix: 'Mebi', shortName: 'MiB' },
        { threshold: bytes_constant_1.KiB, prefix: 'Kibi', shortName: 'KiB' },
    ];
    for (const unit of unitsMap) {
        if (input >= unit.threshold) {
            const value = input / unit.threshold;
            let { shortName } = unit;
            if (units === 'bits') {
                shortName = shortName.replace('i', '');
            }
            return { value, prefix: unit.prefix, shortName };
        }
    }
    return { value: input, prefix: '', shortName: 'B' };
}
function convertByKilobits(input) {
    let value = input;
    let suffix = 'b';
    if (input >= 1000000) {
        value = input / 1000000;
        suffix = 'Mb';
    }
    else if (input >= 1000) {
        value = input / 1000;
        suffix = 'kb';
    }
    return { value, suffix };
}
function convertByThousands(input) {
    let value = input;
    let suffix = '';
    if (input >= 1000000) {
        value = input / 1000000;
        suffix = 'm';
    }
    else if (input >= 1000) {
        value = input / 1000;
        suffix = 'k';
    }
    return { value, suffix };
}
function formatValue(value, units) {
    const dayInSeconds = 60 * 60 * 24;
    const days = value / dayInSeconds;
    const mebibytes = convertKmgt(value * bytes_constant_1.MiB, 'bytes');
    const kibibytes = convertKmgt(value * bytes_constant_1.KiB, 'bytes');
    const kilobits = convertByKilobits(value * 1000);
    const bytes = convertKmgt(value, units);
    const thousands = convertByThousands(value);
    if (typeof value !== 'number')
        return String(value);
    switch (units.toLowerCase()) {
        case 'seconds':
            return `${(0, exports.maxDecimals)(days, 1)} days`;
        case 'mebibytes':
            return `${(0, exports.maxDecimals)(mebibytes.value)} ${mebibytes.shortName}`;
        case 'kibibytes':
            return `${(0, exports.maxDecimals)(kibibytes.value)} ${kibibytes.shortName}`;
        case 'kilobits':
            return `${(0, exports.maxDecimals)(kilobits.value)} ${kilobits.suffix}`;
        case 'bits':
        case 'bytes':
            return `${(0, exports.maxDecimals)(bytes.value)} ${bytes.shortName}`;
        default:
            return `${(0, exports.maxDecimals)(thousands.value)}${thousands.suffix}`;
    }
}
function convertAggregations(input, labelY) {
    const output = Object.assign({}, input);
    const units = inferUnits(labelY);
    const keys = Object.keys(output.aggregations);
    keys.forEach((key) => {
        const values = output.aggregations[key];
        if (Array.isArray(values)) {
            values.forEach((value, index) => {
                const formattedValue = formatValue(value, units);
                const suffix = labelY.endsWith('/s') && formattedValue !== '0' ? '/s' : '';
                output.aggregations[key][index] = formattedValue + suffix;
            });
        }
        else {
            output.aggregations[key] = Object.values(values).map((value) => {
                const formattedValue = formatValue(value, units);
                const suffix = labelY.endsWith('/s') && formattedValue !== '0' ? '/s' : '';
                return formattedValue + suffix;
            });
        }
    });
    return output;
}
function optimizeLegend(input) {
    const output = Object.assign(Object.assign({}, input), { legend: [...input.legend] });
    if (output.legend.includes('time')) {
        output.legend.shift();
    }
    const replacements = {
        upsbatterycharge: () => 'Percent Charge',
        upsremainingbattery: () => 'Time remaining (Minutes)',
        load: (label) => label.replace(/load_/, ''),
        disktemp: () => 'Temperature',
        memory: (label) => label.replace(/memory-|_value/g, ''),
        swap: (label) => label.replace(/swap-|_value/g, ''),
        interface: (label) => label.replace(/if_|octets_/g, (match) => (match === 'octets_' ? 'octets ' : '')),
        nfsstat: (label) => label.replace(/nfsstat-|_value/g, ''),
        nfsstatbytes: (label) => label.replace(/nfsstat-|_bytes_value/g, ''),
        df: (label) => label.replace(/df_complex-|_value/g, ''),
        processes: (label) => label.replace(/ps_state-|_value/g, ''),
        uptime: (label) => label.replace(/_value/g, ''),
        ctl: (label) => label.replace(/disk_octets_/, ''),
        disk: (label) => label.replace(/disk_octets_/, ''),
        diskgeombusy: () => 'Busy',
        diskgeomlatency: (label) => label.replace(/geom_latency-/, ''),
        diskgeomopsrwd: (label) => label.replace(/geom_ops_rwd-/, ''),
        diskgeomqueue: (label) => label.replace(/geom_queue-/, ''),
    };
    if (replacements[output.name]) {
        const replaceFn = replacements[output.name];
        output.legend = output.legend.map((value) => (0, object_keys_to_human_readable_helper_1.toHumanReadableKey)(replaceFn(value)));
    }
    return output;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL3JlcG9ydHMtZGFzaGJvYXJkL3V0aWxzL3JlcG9ydC51dGlscy50cyIsIm1hcHBpbmdzIjoiOzs7QUFPQSxnQ0EwQkM7QUFjRCxnQ0FhQztBQUVELGtDQW9CQztBQUVELDhDQWFDO0FBRUQsZ0RBYUM7QUFFRCxrQ0EwQkM7QUFFRCxrREF1QkM7QUFFRCx3Q0FrQ0M7QUF6TUQsaUVBRXNDO0FBQ3RDLDZEQUE4RDtBQUM5RCwyR0FBc0Y7QUFHdEYsU0FBZ0IsVUFBVSxDQUFDLElBQW1CO0lBQzVDLE1BQU0sYUFBYSxxQkFBdUIsSUFBSSxDQUFFLENBQUM7SUFFakQsSUFDRSxhQUFhLENBQUMsSUFBMEIsS0FBSyxtQ0FBa0IsQ0FBQyxnQkFBZ0I7V0FDN0UsYUFBYSxDQUFDLFlBQVksRUFDN0IsQ0FBQztRQUNELE9BQU8sYUFBYSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUM7SUFDeEMsQ0FBQztJQUVELElBQUksYUFBYSxDQUFDLElBQTBCLEtBQUssbUNBQWtCLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDeEUsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBRTNELGFBQWEsQ0FBQyxJQUFJLEdBQUksYUFBYSxDQUFDLElBQW1CLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztZQUNuRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ04sR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRTtTQUMxQixDQUFDLENBQUM7UUFFSCxJQUFJLGFBQWEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUMvQixhQUFhLENBQUMsWUFBWSxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUMv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WyIvVXNlcnMvbWFjYm9vay9rYXJwb3Ytd29yay9UcnVlTkFTL3dlYnVpL3NyYy9hcHAvcGFnZXMvcmVwb3J0cy1kYXNoYm9hcmQvdXRpbHMvcmVwb3J0LnV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIFRpQiwgR2lCLCBNaUIsIEtpQixcbn0gZnJvbSAnYXBwL2NvbnN0YW50cy9ieXRlcy5jb25zdGFudCc7XG5pbXBvcnQgeyBSZXBvcnRpbmdHcmFwaE5hbWUgfSBmcm9tICdhcHAvZW51bXMvcmVwb3J0aW5nLmVudW0nO1xuaW1wb3J0IHsgdG9IdW1hblJlYWRhYmxlS2V5IH0gZnJvbSAnYXBwL2hlbHBlcnMvb2JqZWN0LWtleXMtdG8taHVtYW4tcmVhZGFibGUuaGVscGVyJztcbmltcG9ydCB7IFJlcG9ydGluZ0FnZ3JlZ2F0aW9uS2V5cywgUmVwb3J0aW5nRGF0YSB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL3JlcG9ydGluZy5pbnRlcmZhY2UnO1xuXG5leHBvcnQgZnVuY3Rpb24gZm9ybWF0RGF0YShkYXRhOiBSZXBvcnRpbmdEYXRhKTogUmVwb3J0aW5nRGF0YSB7XG4gIGNvbnN0IGZvcm1hdHRlZERhdGE6IFJlcG9ydGluZ0RhdGEgPSB7IC4uLmRhdGEgfTtcblxuICBpZiAoXG4gICAgZm9ybWF0dGVkRGF0YS5uYW1lIGFzIFJlcG9ydGluZ0dyYXBoTmFtZSA9PT0gUmVwb3J0aW5nR3JhcGhOYW1lLk5ldHdvcmtJbnRlcmZhY2VcbiAgICAmJiBmb3JtYXR0ZWREYXRhLmFnZ3JlZ2F0aW9uc1xuICApIHtcbiAgICBkZWxldGUgZm9ybWF0dGVkRGF0YS5hZ2dyZWdhdGlvbnMubWluO1xuICB9XG5cbiAgaWYgKGZvcm1hdHRlZERhdGEubmFtZSBhcyBSZXBvcnRpbmdHcmFwaE5hbWUgPT09IFJlcG9ydGluZ0dyYXBoTmFtZS5DcHUpIHtcbiAgICBmb3JtYXR0ZWREYXRhLmxlZ2VuZCA9IFsuLi5mb3JtYXR0ZWREYXRhLmxlZ2VuZF0ucmV2ZXJzZSgpO1xuXG4gICAgZm9ybWF0dGVkRGF0YS5kYXRhID0gKGZvcm1hdHRlZERhdGEuZGF0YSBhcyBudW1iZXJbXVtdKS5tYXAoKHJvdykgPT4gW1xuICAgICAgcm93WzBdLFxuICAgICAgLi4ucm93LnNsaWNlKDEpLnJldmVyc2UoKSxcbiAgICBdKTtcblxuICAgIGlmIChmb3JtYXR0ZWREYXRhLmFnZ3JlZ2F0aW9ucykge1xuICAgICAgZm9ybWF0dGVkRGF0YS5hZ2dyZWdhdGlvbnMubWluID0gWy4uLmZvcm1hdHRlZERhdGEuYWdncmVnYXRpb25zLm1pbl0ucmV2ZXJzZSgpO1xuICAgICAgZm9ybWF0dGVkRGF0YS5hZ2dyZWdhdGlvbnMubWF4ID0gWy4uLmZvcm1hdHRlZERhdGEuYWdncmVnYXRpb25zLm1heF0ucmV2ZXJzZSgpO1xuICAgICAgZm9ybWF0dGVkRGF0YS5hZ2dyZWdhdGlvbnMubWVhbiA9IFsuLi5mb3JtYXR0ZWREYXRhLmFnZ3JlZ2F0aW9ucy5tZWFuXS5yZXZlcnNlKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZvcm1hdHRlZERhdGE7XG59XG5cbmV4cG9ydCBjb25zdCBtYXhEZWNpbWFscyA9IChpbnB1dDogbnVtYmVyLCBtYXggPSAyKTogbnVtYmVyID0+IHtcbiAgY29uc3Qgc3RyID0gaW5wdXQudG9TdHJpbmcoKS5zcGxpdCgnLicpO1xuICBpZiAoIXN0clsxXSkge1xuICAgIC8vIE5vdCBhIGZsb2F0XG4gICAgcmV0dXJuIGlucHV0O1xuICB9XG4gIGNvbnN0IGRlY2ltYWxzID0gc3RyWzFdLmxlbmd0aDtcbiAgY29uc3Qgb3V0cHV0ID0gZGVjaW1hbHMgPiBtYXggPyBpbnB1dC50b0ZpeGVkKG1heCkgOiBpbnB1dDtcbiAgY29uc3QgcHJlcGFyZUlucHV0ID0gcGFyc2VGbG9hdChvdXRwdXQgYXMgc3RyaW5nKTtcbiAgcmV0dXJuIHByZXBhcmVJbnB1dCA8IDEwMDAgPyBOdW1iZXIocHJlcGFyZUlucHV0LnRvU3RyaW5nKCkuc2xpY2UoMCwgNCkpIDogTWF0aC5yb3VuZChwcmVwYXJlSW5wdXQpO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluZmVyVW5pdHMobGFiZWw6IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IGxvd2VyTGFiZWwgPSBsYWJlbC50b0xvd2VyQ2FzZSgpO1xuXG4gIGlmIChsYWJlbC5pbmNsdWRlcygnJScpIHx8IGxvd2VyTGFiZWwuaW5jbHVkZXMoJ3BlcmNlbnRhZ2UnKSkgcmV0dXJuICclJztcbiAgaWYgKGxhYmVsLmluY2x1ZGVzKCfCsCcpIHx8IGxvd2VyTGFiZWwuaW5jbHVkZXMoJ2NlbHNpdXMnKSkgcmV0dXJuICfCsCc7XG4gIGlmIChsb3dlckxhYmVsLmluY2x1ZGVzKCdtZWJpYnl0ZXMnKSkgcmV0dXJuICdtZWJpYnl0ZXMnO1xuICBpZiAobG93ZXJMYWJlbC5pbmNsdWRlcygna2liaWJ5dGVzJykpIHJldHVybiAna2liaWJ5dGVzJztcbiAgaWYgKGxvd2VyTGFiZWwuaW5jbHVkZXMoJ2tpbG9iaXRzJykpIHJldHVybiAna2lsb2JpdHMnO1xuICBpZiAobG93ZXJMYWJlbC5pbmNsdWRlcygnYnl0ZXMnKSkgcmV0dXJuICdieXRlcyc7XG4gIGlmIChsb3dlckxhYmVsLmluY2x1ZGVzKCdiaXRzJykpIHJldHVybiAnYml0cyc7XG5cbiAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgaW5mZXIgdW5pdHMgZnJvbSAnICsgbGFiZWwpO1xuICByZXR1cm4gbGFiZWw7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0S21ndChpbnB1dDogbnVtYmVyLCB1bml0czogc3RyaW5nKTogeyB2YWx1ZTogbnVtYmVyOyBwcmVmaXg6IHN0cmluZzsgc2hvcnROYW1lOiBzdHJpbmcgfSB7XG4gIGNvbnN0IHVuaXRzTWFwID0gW1xuICAgIHsgdGhyZXNob2xkOiBUaUIsIHByZWZpeDogJ1RlYmknLCBzaG9ydE5hbWU6ICdUaUInIH0sXG4gICAgeyB0aHJlc2hvbGQ6IEdpQiwgcHJlZml4OiAnR2liaScsIHNob3J0TmFtZTogJ0dpQicgfSxcbiAgICB7IHRocmVzaG9sZDogTWlCLCBwcmVmaXg6ICdNZWJpJywgc2hvcnROYW1lOiAnTWlCJyB9LFxuICAgIHsgdGhyZXNob2xkOiBLaUIsIHByZWZpeDogJ0tpYmknLCBzaG9ydE5hbWU6ICdLaUInIH0sXG4gIF07XG5cbiAgZm9yIChjb25zdCB1bml0IG9mIHVuaXRzTWFwKSB7XG4gICAgaWYgKGlucHV0ID49IHVuaXQudGhyZXNob2xkKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGlucHV0IC8gdW5pdC50aHJlc2hvbGQ7XG4gICAgICBsZXQgeyBzaG9ydE5hbWUgfSA9IHVuaXQ7XG4gICAgICBpZiAodW5pdHMgPT09ICdiaXRzJykge1xuICAgICAgICBzaG9ydE5hbWUgPSBzaG9ydE5hbWUucmVwbGFjZSgnaScsICcnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHZhbHVlLCBwcmVmaXg6IHVuaXQucHJlZml4LCBzaG9ydE5hbWUgfTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyB2YWx1ZTogaW5wdXQsIHByZWZpeDogJycsIHNob3J0TmFtZTogJ0InIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0QnlLaWxvYml0cyhpbnB1dDogbnVtYmVyKTogeyB2YWx1ZTogbnVtYmVyOyBzdWZmaXg6IHN0cmluZyB9IHtcbiAgbGV0IHZhbHVlID0gaW5wdXQ7XG4gIGxldCBzdWZmaXggPSAnYic7XG5cbiAgaWYgKGlucHV0ID49IDFfMDAwXzAwMCkge1xuICAgIHZhbHVlID0gaW5wdXQgLyAxXzAwMF8wMDA7XG4gICAgc3VmZml4ID0gJ01iJztcbiAgfSBlbHNlIGlmIChpbnB1dCA+PSAxXzAwMCkge1xuICAgIHZhbHVlID0gaW5wdXQgLyAxXzAwMDtcbiAgICBzdWZmaXggPSAna2InO1xuICB9XG5cbiAgcmV0dXJuIHsgdmFsdWUsIHN1ZmZpeCB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydEJ5VGhvdXNhbmRzKGlucHV0OiBudW1iZXIpOiB7IHZhbHVlOiBudW1iZXI7IHN1ZmZpeDogc3RyaW5nIH0ge1xuICBsZXQgdmFsdWUgPSBpbnB1dDtcbiAgbGV0IHN1ZmZpeCA9ICcnO1xuXG4gIGlmIChpbnB1dCA+PSAxXzAwMF8wMDApIHtcbiAgICB2YWx1ZSA9IGlucHV0IC8gMV8wMDBfMDAwO1xuICAgIHN1ZmZpeCA9ICdtJztcbiAgfSBlbHNlIGlmIChpbnB1dCA+PSAxXzAwMCkge1xuICAgIHZhbHVlID0gaW5wdXQgLyAxXzAwMDtcbiAgICBzdWZmaXggPSAnayc7XG4gIH1cblxuICByZXR1cm4geyB2YWx1ZSwgc3VmZml4IH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRWYWx1ZSh2YWx1ZTogbnVtYmVyLCB1bml0czogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgZGF5SW5TZWNvbmRzID0gNjAgKiA2MCAqIDI0O1xuICBjb25zdCBkYXlzID0gdmFsdWUgLyBkYXlJblNlY29uZHM7XG4gIGNvbnN0IG1lYmlieXRlcyA9IGNvbnZlcnRLbWd0KHZhbHVlICogTWlCLCAnYnl0ZXMnKTtcbiAgY29uc3Qga2liaWJ5dGVzID0gY29udmVydEttZ3QodmFsdWUgKiBLaUIsICdieXRlcycpO1xuICBjb25zdCBraWxvYml0cyA9IGNvbnZlcnRCeUtpbG9iaXRzKHZhbHVlICogMTAwMCk7XG4gIGNvbnN0IGJ5dGVzID0gY29udmVydEttZ3QodmFsdWUsIHVuaXRzKTtcbiAgY29uc3QgdGhvdXNhbmRzID0gY29udmVydEJ5VGhvdXNhbmRzKHZhbHVlKTtcblxuICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykgcmV0dXJuIFN0cmluZyh2YWx1ZSk7XG5cbiAgc3dpdGNoICh1bml0cy50b0xvd2VyQ2FzZSgpKSB7XG4gICAgY2FzZSAnc2Vjb25kcyc6XG4gICAgICByZXR1cm4gYCR7bWF4RGVjaW1hbHMoZGF5cywgMSl9IGRheXNgO1xuICAgIGNhc2UgJ21lYmlieXRlcyc6XG4gICAgICByZXR1cm4gYCR7bWF4RGVjaW1hbHMobWViaWJ5dGVzLnZhbHVlKX0gJHttZWJpYnl0ZXMuc2hvcnROYW1lfWA7XG4gICAgY2FzZSAna2liaWJ5dGVzJzpcbiAgICAgIHJldHVybiBgJHttYXhEZWNpbWFscyhraWJpYnl0ZXMudmFsdWUpfSAke2tpYmlieXRlcy5zaG9ydE5hbWV9YDtcbiAgICBjYXNlICdraWxvYml0cyc6XG4gICAgICByZXR1cm4gYCR7bWF4RGVjaW1hbHMoa2lsb2JpdHMudmFsdWUpfSAke2tpbG9iaXRzLnN1ZmZpeH1gO1xuICAgIGNhc2UgJ2JpdHMnOlxuICAgIGNhc2UgJ2J5dGVzJzpcbiAgICAgIHJldHVybiBgJHttYXhEZWNpbWFscyhieXRlcy52YWx1ZSl9ICR7Ynl0ZXMuc2hvcnROYW1lfWA7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBgJHttYXhEZWNpbWFscyh0aG91c2FuZHMudmFsdWUpfSR7dGhvdXNhbmRzLnN1ZmZpeH1gO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb252ZXJ0QWdncmVnYXRpb25zKGlucHV0OiBSZXBvcnRpbmdEYXRhLCBsYWJlbFk/OiBzdHJpbmcpOiBSZXBvcnRpbmdEYXRhIHtcbiAgY29uc3Qgb3V0cHV0ID0geyAuLi5pbnB1dCB9O1xuICBjb25zdCB1bml0cyA9IGluZmVyVW5pdHMobGFiZWxZKTtcbiAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG91dHB1dC5hZ2dyZWdhdGlvbnMpO1xuXG4gIGtleXMuZm9yRWFjaCgoa2V5OiBSZXBvcnRpbmdBZ2dyZWdhdGlvbktleXMpID0+IHtcbiAgICBjb25zdCB2YWx1ZXMgPSBvdXRwdXQuYWdncmVnYXRpb25zW2tleV07XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7XG4gICAgICB2YWx1ZXMuZm9yRWFjaCgodmFsdWUsIGluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gZm9ybWF0VmFsdWUodmFsdWUgYXMgbnVtYmVyLCB1bml0cyk7XG4gICAgICAgIGNvbnN0IHN1ZmZpeCA9IGxhYmVsWS5lbmRzV2l0aCgnL3MnKSAmJiBmb3JtYXR0ZWRWYWx1ZSAhPT0gJzAnID8gJy9zJyA6ICcnO1xuICAgICAgICAob3V0cHV0LmFnZ3JlZ2F0aW9uc1trZXldIGFzIChzdHJpbmcgfCBudW1iZXIpW10pW2luZGV4XSA9IGZvcm1hdHRlZFZhbHVlICsgc3VmZml4O1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dHB1dC5hZ2dyZWdhdGlvbnNba2V5XSA9IE9iamVjdC52YWx1ZXModmFsdWVzKS5tYXAoKHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvcm1hdHRlZFZhbHVlID0gZm9ybWF0VmFsdWUodmFsdWUgYXMgbnVtYmVyLCB1bml0cyk7XG4gICAgICAgIGNvbnN0IHN1ZmZpeCA9IGxhYmVsWS5lbmRzV2l0aCgnL3MnKSAmJiBmb3JtYXR0ZWRWYWx1ZSAhPT0gJzAnID8gJy9zJyA6ICcnO1xuICAgICAgICByZXR1cm4gZm9ybWF0dGVkVmFsdWUgKyBzdWZmaXg7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gb3V0cHV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb3B0aW1pemVMZWdlbmQoaW5wdXQ6IFJlcG9ydGluZ0RhdGEpOiBSZXBvcnRpbmdEYXRhIHtcbiAgY29uc3Qgb3V0cHV0ID0geyAuLi5pbnB1dCwgbGVnZW5kOiBbLi4uaW5wdXQubGVnZW5kXSB9O1xuXG4gIGlmIChvdXRwdXQubGVnZW5kLmluY2x1ZGVzKCd0aW1lJykpIHtcbiAgICBvdXRwdXQubGVnZW5kLnNoaWZ0KCk7XG4gIH1cblxuICBjb25zdCByZXBsYWNlbWVudHM6IFJlY29yZDxzdHJpbmcsIChsYWJlbDogc3RyaW5nKSA9PiBzdHJpbmc+ID0ge1xuICAgIHVwc2JhdHRlcnljaGFyZ2U6ICgpID0+ICdQZXJjZW50IENoYXJnZScsXG4gICAgdXBzcmVtYWluaW5nYmF0dGVyeTogKCkgPT4gJ1RpbWUgcmVtYWluaW5nIChNaW51dGVzKScsXG4gICAgbG9hZDogKGxhYmVsKSA9PiBsYWJlbC5yZXBsYWNlKC9sb2FkXy8sICcnKSxcbiAgICBkaXNrdGVtcDogKCkgPT4gJ1RlbXBlcmF0dXJlJyxcbiAgICBtZW1vcnk6IChsYWJlbCkgPT4gbGFiZWwucmVwbGFjZSgvbWVtb3J5LXxfdmFsdWUvZywgJycpLFxuICAgIHN3YXA6IChsYWJlbCkgPT4gbGFiZWwucmVwbGFjZSgvc3dhcC18X3ZhbHVlL2csICcnKSxcbiAgICBpbnRlcmZhY2U6IChsYWJlbCkgPT4gbGFiZWwucmVwbGFjZSgvaWZffG9jdGV0c18vZywgKG1hdGNoKSA9PiAobWF0Y2ggPT09ICdvY3RldHNfJyA/ICdvY3RldHMgJyA6ICcnKSksXG4gICAgbmZzc3RhdDogKGxhYmVsKSA9PiBsYWJlbC5yZXBsYWNlKC9uZnNzdGF0LXxfdmFsdWUvZywgJycpLFxuICAgIG5mc3N0YXRieXRlczogKGxhYmVsKSA9PiBsYWJlbC5yZXBsYWNlKC9uZnNzdGF0LXxfYnl0ZXNfdmFsdWUvZywgJycpLFxuICAgIGRmOiAobGFiZWwpID0+IGxhYmVsLnJlcGxhY2UoL2RmX2NvbXBsZXgtfF92YWx1ZS9nLCAnJyksXG4gICAgcHJvY2Vzc2VzOiAobGFiZWwpID0+IGxhYmVsLnJlcGxhY2UoL3BzX3N0YXRlLXxfdmFsdWUvZywgJycpLFxuICAgIHVwdGltZTogKGxhYmVsKSA9PiBsYWJlbC5yZXBsYWNlKC9fdmFsdWUvZywgJycpLFxuICAgIGN0bDogKGxhYmVsKSA9PiBsYWJlbC5yZXBsYWNlKC9kaXNrX29jdGV0c18vLCAnJyksXG4gICAgZGlzazogKGxhYmVsKSA9PiBsYWJlbC5yZXBsYWNlKC9kaXNrX29jdGV0c18vLCAnJyksXG4gICAgZGlza2dlb21idXN5OiAoKSA9PiAnQnVzeScsXG4gICAgZGlza2dlb21sYXRlbmN5OiAobGFiZWwpID0+IGxhYmVsLnJlcGxhY2UoL2dlb21fbGF0ZW5jeS0vLCAnJyksXG4gICAgZGlza2dlb21vcHNyd2Q6IChsYWJlbCkgPT4gbGFiZWwucmVwbGFjZSgvZ2VvbV9vcHNfcndkLS8sICcnKSxcbiAgICBkaXNrZ2VvbXF1ZXVlOiAobGFiZWwpID0+IGxhYmVsLnJlcGxhY2UoL2dlb21fcXVldWUtLywgJycpLFxuICB9O1xuXG4gIGlmIChyZXBsYWNlbWVudHNbb3V0cHV0Lm5hbWVdKSB7XG4gICAgY29uc3QgcmVwbGFjZUZuID0gcmVwbGFjZW1lbnRzW291dHB1dC5uYW1lXTtcbiAgICBvdXRwdXQubGVnZW5kID0gb3V0cHV0LmxlZ2VuZC5tYXAoKHZhbHVlKSA9PiB0b0h1bWFuUmVhZGFibGVLZXkocmVwbGFjZUZuKHZhbHVlKSkpO1xuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==